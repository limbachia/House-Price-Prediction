

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>1. Data Wrangling &#8212; Ames, Iowa Housing Dataset</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/sphinx-book-theme.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/togglebutton.js"></script>
    <script type="text/javascript" src="_static/clipboard.min.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script type="text/javascript" src="_static/mystnb.js"></script>
    <script type="text/javascript" src="_static/sphinx-book-theme.js"></script>
    <script type="text/javascript">var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@jupyter-widgets/html-manager@^0.14.0/dist/embed-amd.js"></script>
    <script async="async" type="text/javascript" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script type="text/javascript">
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" type="text/javascript" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Data Storytelling" href="01-data-storytelling.html" />
    <link rel="prev" title="House Price Prediction" href="intro.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.jpg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Ames, Iowa Housing Dataset</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   House Price Prediction
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   1.
   <strong>
    Data Wrangling
   </strong>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01-data-storytelling.html">
   2. Data Storytelling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02-feature-engineering.html">
   3. Statistical Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-model-building.html">
   4. Model Building
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-model-building.html#table-of-contents">
   5. Table of Contents
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/00-data-wrangling.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distributions-of-continous-features">
   1.1. Distributions of Continous Features.
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#distribution-of-saleprice-target-variable">
   1.2. Distribution of SalePrice (target variable)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#outlier-identification">
   1.3. Outlier Identification
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-grlivarea">
     1.3.1. Distribution of GrLivArea
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-garagearea">
     1.3.2. Distribution of GarageArea
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-lotarea">
     1.3.3. Distribution LotArea
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#missing-value-treatment">
   1.4. Missing Value Treatment
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorical-features">
     1.4.1. Categorical Features
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#electrical-masvnrtype">
       1.4.1.1. Electrical &amp; MasVnrType
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#numerical-features">
     1.4.2. Numerical Features
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#masvnrarea">
       1.4.2.1. MasVnrArea
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#garageyrblt">
       1.4.2.2. GarageYrBlt
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lotforntage">
       1.4.2.3. LotForntage
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-augmentation">
   1.5. Data Augmentation
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#google-api-geocoding">
     1.5.1. Google API: Geocoding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uszipcode">
     1.5.2. uszipcode
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">HTML</span>

<span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;&lt;script&gt;</span>
<span class="s1">code_show=true; </span>
<span class="s1">function code_toggle() {</span>
<span class="s1"> if (code_show){</span>
<span class="s1"> $(&#39;div.input&#39;).hide();</span>
<span class="s1"> } else {</span>
<span class="s1"> $(&#39;div.input&#39;).show();</span>
<span class="s1"> }</span>
<span class="s1"> code_show = !code_show</span>
<span class="s1">} </span>
<span class="s1">$( document ).ready(code_toggle);</span>
<span class="s1">&lt;/script&gt;</span>
<span class="s1">&lt;form action=&quot;javascript:code_toggle()&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;Show Code&quot;&gt;&lt;/form&gt;&#39;&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><script>
code_show=true; 
function code_toggle() {
 if (code_show){
 $('div.input').hide();
 } else {
 $('div.input').show();
 }
 code_show = !code_show
} 
$( document ).ready(code_toggle);
</script>
<form action="javascript:code_toggle()"><input type="submit" value="Show Code"></form></div></div>
</div>
<div class="section" id="data-wrangling">
<h1>1. <strong>Data Wrangling</strong><a class="headerlink" href="#data-wrangling" title="Permalink to this headline">¶</a></h1>
<p><strong>Problem Statement</strong></p>
<p>Buying a house can be a very challenging process. It takes time, patience, and a lot of research to find a house that you like and then negotiate the right price for it. There are several features that influence house price such as the building type, total number of rooms, garage size, masonary work, location, utilities, and many more. Can house price be estimated (or predicted) using these features? Can we identify features that influence house price the most? How important is Building Type in determining the price? What influences the price more: location or size (sq.ft.)? How much value does remodeling add to the house? These are a few questions among many more that I intend to explore and answer.</p>
<p><strong>Dataset</strong></p>
<p>Dataset is available on kaggle (https://www.kaggle.com/c/house-prices-advanced-regression-techniques). It is the Ames Housing dataset, compiled by Dean De Cock. It has 1460 instances and 79 explanatory variables that describe almost every aspect of residential homes in Ames, Iowa.</p>
<p>In this part, we will explore the data. In the process, we will clean and augment the data with additional information from other sources. We will perform the following steps:</p>
<ul class="simple">
<li><p>Identify and remove outliers</p></li>
<li><p>Fill missing values</p></li>
<li><p>Augment the dataset by collecting and adding data from other sources like Google’s Geocoding API and uszipcode library</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import useful libraries</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span> <span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>

<span class="c1"># sklearn pipeline tools</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="k">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="k">import</span> <span class="n">Pipeline</span>

<span class="c1"># Set waring to &#39;ignore&#39; to prevent them from prining on screen</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the dataset, and look at first few rows</span>
<span class="n">housing_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/train.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Id&#39;</span><span class="p">)</span>
<span class="n">housing</span> <span class="o">=</span> <span class="n">housing_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">housing</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MSSubClass</th>
      <th>MSZoning</th>
      <th>LotFrontage</th>
      <th>LotArea</th>
      <th>Street</th>
      <th>Alley</th>
      <th>LotShape</th>
      <th>LandContour</th>
      <th>Utilities</th>
      <th>LotConfig</th>
      <th>...</th>
      <th>PoolArea</th>
      <th>PoolQC</th>
      <th>Fence</th>
      <th>MiscFeature</th>
      <th>MiscVal</th>
      <th>MoSold</th>
      <th>YrSold</th>
      <th>SaleType</th>
      <th>SaleCondition</th>
      <th>SalePrice</th>
    </tr>
    <tr>
      <th>Id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>60</td>
      <td>RL</td>
      <td>65.0</td>
      <td>8450</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>208500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20</td>
      <td>RL</td>
      <td>80.0</td>
      <td>9600</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>Reg</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>5</td>
      <td>2007</td>
      <td>WD</td>
      <td>Normal</td>
      <td>181500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>60</td>
      <td>RL</td>
      <td>68.0</td>
      <td>11250</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Inside</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>9</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>223500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>70</td>
      <td>RL</td>
      <td>60.0</td>
      <td>9550</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>Corner</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>2</td>
      <td>2006</td>
      <td>WD</td>
      <td>Abnorml</td>
      <td>140000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>60</td>
      <td>RL</td>
      <td>84.0</td>
      <td>14260</td>
      <td>Pave</td>
      <td>NaN</td>
      <td>IR1</td>
      <td>Lvl</td>
      <td>AllPub</td>
      <td>FR2</td>
      <td>...</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
      <td>12</td>
      <td>2008</td>
      <td>WD</td>
      <td>Normal</td>
      <td>250000</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 80 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Datatype of each column</span>
<span class="n">housing</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 1460 entries, 1 to 1460
Data columns (total 80 columns):
MSSubClass       1460 non-null int64
MSZoning         1460 non-null object
LotFrontage      1201 non-null float64
LotArea          1460 non-null int64
Street           1460 non-null object
Alley            91 non-null object
LotShape         1460 non-null object
LandContour      1460 non-null object
Utilities        1460 non-null object
LotConfig        1460 non-null object
LandSlope        1460 non-null object
Neighborhood     1460 non-null object
Condition1       1460 non-null object
Condition2       1460 non-null object
BldgType         1460 non-null object
HouseStyle       1460 non-null object
OverallQual      1460 non-null int64
OverallCond      1460 non-null int64
YearBuilt        1460 non-null int64
YearRemodAdd     1460 non-null int64
RoofStyle        1460 non-null object
RoofMatl         1460 non-null object
Exterior1st      1460 non-null object
Exterior2nd      1460 non-null object
MasVnrType       1452 non-null object
MasVnrArea       1452 non-null float64
ExterQual        1460 non-null object
ExterCond        1460 non-null object
Foundation       1460 non-null object
BsmtQual         1423 non-null object
BsmtCond         1423 non-null object
BsmtExposure     1422 non-null object
BsmtFinType1     1423 non-null object
BsmtFinSF1       1460 non-null int64
BsmtFinType2     1422 non-null object
BsmtFinSF2       1460 non-null int64
BsmtUnfSF        1460 non-null int64
TotalBsmtSF      1460 non-null int64
Heating          1460 non-null object
HeatingQC        1460 non-null object
CentralAir       1460 non-null object
Electrical       1459 non-null object
1stFlrSF         1460 non-null int64
2ndFlrSF         1460 non-null int64
LowQualFinSF     1460 non-null int64
GrLivArea        1460 non-null int64
BsmtFullBath     1460 non-null int64
BsmtHalfBath     1460 non-null int64
FullBath         1460 non-null int64
HalfBath         1460 non-null int64
BedroomAbvGr     1460 non-null int64
KitchenAbvGr     1460 non-null int64
KitchenQual      1460 non-null object
TotRmsAbvGrd     1460 non-null int64
Functional       1460 non-null object
Fireplaces       1460 non-null int64
FireplaceQu      770 non-null object
GarageType       1379 non-null object
GarageYrBlt      1379 non-null float64
GarageFinish     1379 non-null object
GarageCars       1460 non-null int64
GarageArea       1460 non-null int64
GarageQual       1379 non-null object
GarageCond       1379 non-null object
PavedDrive       1460 non-null object
WoodDeckSF       1460 non-null int64
OpenPorchSF      1460 non-null int64
EnclosedPorch    1460 non-null int64
3SsnPorch        1460 non-null int64
ScreenPorch      1460 non-null int64
PoolArea         1460 non-null int64
PoolQC           7 non-null object
Fence            281 non-null object
MiscFeature      54 non-null object
MiscVal          1460 non-null int64
MoSold           1460 non-null int64
YrSold           1460 non-null int64
SaleType         1460 non-null object
SaleCondition    1460 non-null object
SalePrice        1460 non-null int64
dtypes: float64(3), int64(34), object(43)
memory usage: 923.9+ KB
</pre></div>
</div>
</div>
</div>
<p>We can see there are a lot of numerical and categorical features.<br />
Lets first take look at the numerical (particularly continous) features to spot outliers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Created a list of continous features to check their distribution and spot potential outliers</span>
<span class="n">cont_feats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">,</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">,</span>
              <span class="s1">&#39;LotArea&#39;</span><span class="p">,</span><span class="s1">&#39;MasVnrArea&#39;</span><span class="p">,</span>
              <span class="s1">&#39;BsmtFinSF1&#39;</span><span class="p">,</span><span class="s1">&#39;BsmtFinSF2&#39;</span><span class="p">,</span>
              <span class="s1">&#39;BsmtUnfSF&#39;</span><span class="p">,</span><span class="s1">&#39;TotalBsmtSF&#39;</span><span class="p">,</span>
              <span class="s1">&#39;1stFlrSF&#39;</span><span class="p">,</span><span class="s1">&#39;2ndFlrSF&#39;</span><span class="p">,</span>
              <span class="s1">&#39;LowQualFinSF&#39;</span><span class="p">,</span><span class="s1">&#39;GrLivArea&#39;</span><span class="p">,</span>
              <span class="s1">&#39;GarageArea&#39;</span><span class="p">,</span><span class="s1">&#39;WoodDeckSF&#39;</span><span class="p">,</span>
              <span class="s1">&#39;OpenPorchSF&#39;</span><span class="p">,</span><span class="s1">&#39;EnclosedPorch&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ScreenPorch&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="distributions-of-continous-features">
<h2>1.1. Distributions of Continous Features.<a class="headerlink" href="#distributions-of-continous-features" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="o">=</span><span class="n">housing</span><span class="p">[</span><span class="n">cont_feats</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_9_0.png" src="_images/00-data-wrangling_9_0.png" />
</div>
</div>
</div>
<div class="section" id="distribution-of-saleprice-target-variable">
<h2>1.2. Distribution of SalePrice (target variable)<a class="headerlink" href="#distribution-of-saleprice-target-variable" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">5e5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">SalePrice</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_12_0.png" src="_images/00-data-wrangling_12_0.png" />
</div>
</div>
<p>Distribution has a postive skew.  Let apply a log tranform.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">5e5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">SalePrice</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_15_0.png" src="_images/00-data-wrangling_15_0.png" />
</div>
</div>
<p>Looks close to normal after tranforming.</p>
</div>
<div class="section" id="outlier-identification">
<h2>1.3. Outlier Identification<a class="headerlink" href="#outlier-identification" title="Permalink to this headline">¶</a></h2>
<div class="section" id="distribution-of-grlivarea">
<h3>1.3.1. Distribution of GrLivArea<a class="headerlink" href="#distribution-of-grlivarea" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">GrLivArea</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">GrLivArea</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_19_0.png" src="_images/00-data-wrangling_19_0.png" />
</div>
</div>
<p>Distribution has positve skew.</p>
<p>Lets also apply log tranform to GrLivArea.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize a transformer list object to keep track of all data preprocessing steps</span>
<span class="n">transformers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">log1p</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">X_new</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">X_new</span><span class="p">[</span><span class="s1">&#39;log1p(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">col</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">X_new</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
        <span class="c1">#X_new.drop(col,axis=1,inplace=True)</span>
    <span class="k">return</span> <span class="n">X_new</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">FunctionTransformer</span>
<span class="n">log_trans</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">log1p</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">kw_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GrLivArea&#39;</span><span class="p">]))</span>
<span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;log_trans&#39;</span><span class="p">,</span><span class="n">log_trans</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(GrLivArea)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">GrLivArea</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(GrLivArea)&#39;</span><span class="p">],</span><span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">housing</span><span class="p">))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(GrLivArea)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(GrLivArea)&#39;</span><span class="p">],</span> <span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;log1p(GrLivArea)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;log1p(SalePrice)&#39;)
</pre></div>
</div>
<img alt="_images/00-data-wrangling_24_1.png" src="_images/00-data-wrangling_24_1.png" />
</div>
</div>
<p>No apparent outliers in log of GrLivArea. Distrubution also looks normal.</p>
</div>
<div class="section" id="distribution-of-garagearea">
<h3>1.3.2. Distribution of GarageArea<a class="headerlink" href="#distribution-of-garagearea" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">GarageArea</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">GarageArea</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_27_0.png" src="_images/00-data-wrangling_27_0.png" />
</div>
</div>
<p>Distibution looks reasonably normal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">GarageArea</span><span class="p">,</span> 
            <span class="n">housing</span><span class="o">.</span><span class="n">SalePrice</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;GarageArea&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;SalePrice&#39;)
</pre></div>
</div>
<img alt="_images/00-data-wrangling_29_1.png" src="_images/00-data-wrangling_29_1.png" />
</div>
</div>
<p>No apparent outliers in the scatter plot</p>
</div>
<div class="section" id="distribution-lotarea">
<h3>1.3.3. Distribution LotArea<a class="headerlink" href="#distribution-lotarea" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">LotArea</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">LotArea</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_32_0.png" src="_images/00-data-wrangling_32_0.png" />
</div>
</div>
<p>Distribution is highly skewed due to outliers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">LotArea</span><span class="p">,</span> 
            <span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;LotArea&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;log1p(SalePrice)&#39;)
</pre></div>
</div>
<img alt="_images/00-data-wrangling_34_1.png" src="_images/00-data-wrangling_34_1.png" />
</div>
</div>
<p>LotArea &gt; 60000 seem like outliers. Lets remove them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">LotArea</span><span class="p">,</span> 
            <span class="n">housing</span><span class="p">[</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">],</span> 
            <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;LotArea&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">)</span>

<span class="n">outlier</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">outlier</span><span class="p">[</span><span class="s1">&#39;LotArea&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">housing</span><span class="o">.</span><span class="n">LotArea</span> <span class="o">&gt;</span> <span class="mi">60000</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="o">~</span><span class="n">outlier</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">LotArea</span><span class="p">,</span> <span class="n">housing</span><span class="p">[</span><span class="o">~</span><span class="n">outlier</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">marker</span> <span class="o">=</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;LotArea&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;After removing Lot Area &gt; </span><span class="si">%.0f</span><span class="s1"> sq.ft.&#39;</span> <span class="o">%</span><span class="p">(</span><span class="mi">60000</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;After removing Lot Area &gt; 60000 sq.ft.&#39;)
</pre></div>
</div>
<img alt="_images/00-data-wrangling_36_1.png" src="_images/00-data-wrangling_36_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">LotArea</span><span class="p">,</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">LotArea</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Before outlier removal&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="o">~</span><span class="n">outlier</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;LotArea&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="s1">&#39;Skew = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="p">[</span><span class="o">~</span><span class="n">outlier</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)][</span><span class="s1">&#39;LotArea&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">skew</span><span class="p">()),</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">})</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;After outlier removal&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_37_0.png" src="_images/00-data-wrangling_37_0.png" />
</div>
</div>
<p>Skeweness improved considerably after removing outliers. Distribution has looks reasonably normal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of examples before outlier removal: &#39;</span><span class="p">,</span><span class="n">housing</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of examples after outlier removal: &#39;</span><span class="p">,</span><span class="n">housing</span><span class="p">[</span><span class="o">~</span><span class="n">outlier</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> examples are excluded&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">housing</span><span class="p">[</span><span class="o">~</span><span class="n">outlier</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Number of examples before outlier removal:  1460
Number of examples after outlier removal:  1454
6 examples are excluded
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remove_outliers</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">columns</span><span class="p">,</span><span class="n">thresholds</span><span class="p">):</span>
    <span class="n">outlier</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">column</span><span class="p">,</span><span class="n">threshold</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span><span class="n">thresholds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;GrLivArea&#39;</span><span class="p">:</span>
            <span class="n">outlier</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span>
        <span class="k">elif</span> <span class="n">column</span> <span class="o">==</span> <span class="s1">&#39;LotArea&#39;</span><span class="p">:</span>
            <span class="n">percentile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">column</span><span class="p">],</span><span class="mi">99</span><span class="p">)</span>
            <span class="n">outlier</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">column</span><span class="o">+</span><span class="s1">&#39; not processed for outliers&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">outlier</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>

<span class="n">outlier_remover</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">remove_outliers</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">kw_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LotArea&#39;</span><span class="p">],</span>
                                                   <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mi">60000</span><span class="p">]))</span>
<span class="n">outlier_remover</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span> <span class="c1"># Fit on training data</span>

<span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;outlier_remover&#39;</span><span class="p">,</span><span class="n">outlier_remover</span><span class="p">))</span>

<span class="n">housing</span> <span class="o">=</span> <span class="n">outlier_remover</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span> <span class="c1">## Use this line instead the next cell</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#housing = housing[~outlier.any(axis=1)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataset size:&#39;</span><span class="p">,</span><span class="n">housing</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Dataset size: (1454, 82)
</pre></div>
</div>
</div>
</div>
<p>For more advanced methods of dealing with outliers, ref to:<br />
1. https://pyod.readthedocs.io/en/latest/<br />
2. https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.IsolationForest.html#sklearn.ensemble.IsolationForest</p>
<p>In the next step we will treat missing values.</p>
</div>
</div>
<div class="section" id="missing-value-treatment">
<h2>1.4. Missing Value Treatment<a class="headerlink" href="#missing-value-treatment" title="Permalink to this headline">¶</a></h2>
<div class="section" id="categorical-features">
<h3>1.4.1. Categorical Features<a class="headerlink" href="#categorical-features" title="Permalink to this headline">¶</a></h3>
<p>Lets first treat missing values in the categorical features</p>
<p><strong>MSSubclass</strong> is a categorical feature but it got loaded as a numerical feature, so lets change it to categorical.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">columns</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">X</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>

<span class="n">to_string</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">to_str</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">kw_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MSSubClass&quot;</span><span class="p">]))</span>
<span class="n">to_string</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span> <span class="c1"># fit on training data</span>
<span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;MSSubClass_to_str&#39;</span><span class="p">,</span><span class="n">to_string</span><span class="p">))</span>
<span class="n">housing</span> <span class="o">=</span> <span class="n">to_string</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>

<span class="c1"># Initialize a feature dictionary which will keep track of all features</span>
<span class="n">FEATURES</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">missing_vals_cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">,</span> <span class="s1">&#39;# of missing vals&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f missing vals&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">numNan</span> <span class="ow">in</span> <span class="n">housing</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">housing</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numNan</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">missing_vals_cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">missing_vals_cat</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">feature</span><span class="p">,</span><span class="n">numNan</span><span class="p">,(</span><span class="n">numNan</span><span class="o">/</span><span class="n">housing</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">],</span>
                                                                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">,</span> <span class="s1">&#39;# of missing vals&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f missing vals&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
            
<span class="n">missing_vals_cat</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f missing vals&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature</th>
      <th># of missing vals</th>
      <th>% of missing vals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>PoolQC</td>
      <td>1448</td>
      <td>99.5873</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MiscFeature</td>
      <td>1402</td>
      <td>96.4237</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Alley</td>
      <td>1363</td>
      <td>93.7414</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Fence</td>
      <td>1173</td>
      <td>80.674</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FireplaceQu</td>
      <td>690</td>
      <td>47.4553</td>
    </tr>
    <tr>
      <th>5</th>
      <td>GarageType</td>
      <td>81</td>
      <td>5.57084</td>
    </tr>
    <tr>
      <th>6</th>
      <td>GarageFinish</td>
      <td>81</td>
      <td>5.57084</td>
    </tr>
    <tr>
      <th>7</th>
      <td>GarageQual</td>
      <td>81</td>
      <td>5.57084</td>
    </tr>
    <tr>
      <th>8</th>
      <td>GarageCond</td>
      <td>81</td>
      <td>5.57084</td>
    </tr>
    <tr>
      <th>9</th>
      <td>BsmtExposure</td>
      <td>38</td>
      <td>2.61348</td>
    </tr>
    <tr>
      <th>10</th>
      <td>BsmtFinType2</td>
      <td>38</td>
      <td>2.61348</td>
    </tr>
    <tr>
      <th>11</th>
      <td>BsmtQual</td>
      <td>37</td>
      <td>2.5447</td>
    </tr>
    <tr>
      <th>12</th>
      <td>BsmtCond</td>
      <td>37</td>
      <td>2.5447</td>
    </tr>
    <tr>
      <th>13</th>
      <td>BsmtFinType1</td>
      <td>37</td>
      <td>2.5447</td>
    </tr>
    <tr>
      <th>14</th>
      <td>MasVnrType</td>
      <td>8</td>
      <td>0.550206</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Electrical</td>
      <td>1</td>
      <td>0.0687758</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>There are two categorical features, <strong>Electrical</strong> and <strong>MasVnrType</strong>, that have missing values. Both have insignificant amounts of missing values (0.072% and 0.51%), hence it will be reasonable to impute them with the most frequently occuring category.</p>
<p>All other features have “meaningful” missing values. For example, if a house does not have a basement, all features related basement are going to be null values. Hence, replace those missing values in another category called “<strong>Missing</strong>”.</p>
<div class="section" id="electrical-masvnrtype">
<h4>1.4.1.1. Electrical &amp; MasVnrType<a class="headerlink" href="#electrical-masvnrtype" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Electrical&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">housing</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Electrical&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;MasVnrType&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">housing</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;MasVnrType&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;MasVnrType&#39;)
</pre></div>
</div>
<img alt="_images/00-data-wrangling_52_1.png" src="_images/00-data-wrangling_52_1.png" />
</div>
</div>
<p><em><strong>SBrkr</strong></em> is the most frequent category in the <strong>Electrical</strong>.</p>
<p><em><strong>None</strong></em> is the most frequent category in <strong>MasVnrType</strong>.</p>
<p>Impute the missing categories with most frequently occuring ones.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat_mode_mapper</span> <span class="o">=</span> <span class="n">housing</span><span class="p">[</span><span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">impute_cat</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">feat_to_mode</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Electrical&#39;</span><span class="p">,</span><span class="s1">&#39;MasVnrType&#39;</span><span class="p">],</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">cat_mode_mapper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Imputes missing values in Electrical and MasVnrType with modes, </span>
<span class="sd">    and replaces NaN values in all other categorical features with &#39;Missing&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">feat_to_mode</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Missing&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>

<span class="n">cat_Imputer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">impute_cat</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">kw_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">feat_to_mode</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Electrical&#39;</span><span class="p">,</span><span class="s1">&#39;MasVnrType&#39;</span><span class="p">],</span>
                                                   <span class="n">mapper</span><span class="o">=</span><span class="n">cat_mode_mapper</span><span class="p">))</span>
<span class="n">cat_Imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span>
<span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;cat_Imputer&#39;</span><span class="p">,</span><span class="n">cat_Imputer</span><span class="p">))</span>
<span class="n">housing</span> <span class="o">=</span> <span class="n">cat_Imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if there are missing values in the categorical features any more</span>
<span class="n">housing</span><span class="p">[</span><span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>MSSubClass       0
MSZoning         0
Street           0
Alley            0
LotShape         0
LandContour      0
Utilities        0
LotConfig        0
LandSlope        0
Neighborhood     0
Condition1       0
Condition2       0
BldgType         0
HouseStyle       0
RoofStyle        0
RoofMatl         0
Exterior1st      0
Exterior2nd      0
MasVnrType       0
ExterQual        0
ExterCond        0
Foundation       0
BsmtQual         0
BsmtCond         0
BsmtExposure     0
BsmtFinType1     0
BsmtFinType2     0
Heating          0
HeatingQC        0
CentralAir       0
Electrical       0
KitchenQual      0
Functional       0
FireplaceQu      0
GarageType       0
GarageFinish     0
GarageQual       0
GarageCond       0
PavedDrive       0
PoolQC           0
Fence            0
MiscFeature      0
SaleType         0
SaleCondition    0
dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="numerical-features">
<h3>1.4.2. Numerical Features<a class="headerlink" href="#numerical-features" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">missing_vals_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">,</span><span class="s1">&#39;# of missing values&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f missing values&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">feature</span><span class="p">,</span> <span class="n">numNan</span> <span class="ow">in</span> <span class="n">housing</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">housing</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span><span class="o">!=</span> <span class="s1">&#39;object&#39;</span> <span class="ow">and</span> <span class="s1">&#39;SalePrice&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">:</span>
        <span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numNan</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">missing_vals_num</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">missing_vals_num</span><span class="p">,</span>
                                          <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">feature</span><span class="p">,</span><span class="n">numNan</span><span class="p">,</span>
                                                        <span class="p">(</span><span class="n">numNan</span><span class="o">/</span><span class="n">housing</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">],</span>
                                                       <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Feature&#39;</span><span class="p">,</span><span class="s1">&#39;# of missing values&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">% o</span><span class="s1">f missing values&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>

<span class="n">missing_vals_num</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;# of missing values&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature</th>
      <th># of missing values</th>
      <th>% of missing values</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LotFrontage</td>
      <td>256</td>
      <td>17.6066</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GarageYrBlt</td>
      <td>81</td>
      <td>5.57084</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MasVnrArea</td>
      <td>8</td>
      <td>0.550206</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="section" id="masvnrarea">
<h4>1.4.2.1. MasVnrArea<a class="headerlink" href="#masvnrarea" title="Permalink to this headline">¶</a></h4>
<p><strong>MasVnrArea</strong>: Since the most common category (None) was imputed for the missing values in the cat feature, <strong>MasVnrType</strong>, it will make sense to impute missing values in <strong>MasVnrArea</strong> with median <strong>MasVnrArea</strong> value of houses that have “None” as the <strong>MasVnrType</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MedianMasVnrArea</span> <span class="o">=</span> <span class="n">housing</span><span class="p">[</span><span class="n">housing</span><span class="p">[</span><span class="s1">&#39;MasVnrType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">][</span><span class="s1">&#39;MasVnrArea&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median MasVnrArea: &quot;</span><span class="p">,</span><span class="n">MedianMasVnrArea</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Median MasVnrArea:  0.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="garageyrblt">
<h4>1.4.2.2. GarageYrBlt<a class="headerlink" href="#garageyrblt" title="Permalink to this headline">¶</a></h4>
<p><strong>GarageYrBlt</strong>: these are same rows which have missing values in other garage related features, indicating that these houses do not have a garage. Imputing median value is a safe option, as these houses have already been flagged as missing a garage in the categorical features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MedianGarageYrBlt</span> <span class="o">=</span> <span class="n">housing</span><span class="p">[</span><span class="s1">&#39;GarageYrBlt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Median GarageYrBlt: &quot;</span><span class="p">,</span><span class="n">MedianGarageYrBlt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Median GarageYrBlt:  1980.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lotforntage">
<h4>1.4.2.3. LotForntage<a class="headerlink" href="#lotforntage" title="Permalink to this headline">¶</a></h4>
<p><strong>LotForntage</strong>: missing values needs to be handled more carefully as they amount to 17.73% of the total oberservation.</p>
<ul class="simple">
<li><p>Let’s take a look at the other three features associated with Lot: LotConfig, LotShape, and LotArea</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;LotConfig&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">housing</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;LotShape&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;LotArea&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">housing</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f810a3187f0&gt;
</pre></div>
</div>
<img alt="_images/00-data-wrangling_63_1.png" src="_images/00-data-wrangling_63_1.png" />
</div>
</div>
<ul class="simple">
<li><p>Group the data by <strong>LotShape</strong> and <strong>LotConfig</strong> and compute group specific median <strong>LotFrontage</strong>.</p></li>
<li><p>Impute missing <strong>LotFrontage</strong> with group specific median LotFrontage values.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_median_mapper</span> <span class="o">=</span> <span class="n">housing</span><span class="p">[</span><span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">num_median_mapper</span><span class="p">[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">housing</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;LotConfig&#39;</span><span class="p">,</span><span class="s1">&#39;LotShape&#39;</span><span class="p">])[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">impute_num</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">mapper</span><span class="o">=</span><span class="n">num_median_mapper</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">feat</span><span class="p">,</span><span class="n">vals</span> <span class="ow">in</span> <span class="n">mapper</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">feat</span> <span class="o">==</span> <span class="s1">&#39;LotFrontage&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">LotConfig</span><span class="p">,</span><span class="n">LotShape</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;LotConfig&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">LotConfig</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;LotShape&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">LotShape</span><span class="p">),[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">X</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="s1">&#39;LotFrontage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>

<span class="n">num_imputer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">impute_num</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                      <span class="n">kw_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="n">num_median_mapper</span><span class="p">))</span>
<span class="n">num_imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span>

<span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;num_imputer&#39;</span><span class="p">,</span><span class="n">num_imputer</span><span class="p">))</span>

<span class="n">housing</span> <span class="o">=</span> <span class="n">num_imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check if there are any missing values in the entire dataset anymore.</span>
<span class="n">housing</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p><strong>Data cleaning is done at this point.</strong></p>
<p>Next, we will add more data to the dataset from other sources.</p>
</div>
</div>
</div>
<div class="section" id="data-augmentation">
<h2>1.5. Data Augmentation<a class="headerlink" href="#data-augmentation" title="Permalink to this headline">¶</a></h2>
<p>In this part, we will add more features to the dataset by gathering data from other sources like <strong>Google’s Geocoding API</strong> and <strong>uszipcode</strong> library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Number of unique categories per categorical feature</span>
<span class="n">unique_cats</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">housing</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">housing</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="n">unique_cats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">housing</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
        <span class="c1">#print(&#39;{0}:\t\t {1} unique categories&#39;.format(col,housing_cat[col].nunique()))</span>

<span class="n">num_unique_cats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">unique_cats</span><span class="p">)</span>
<span class="n">num_unique_cats</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Neighborhood     25
Exterior2nd      16
MSSubClass       15
Exterior1st      15
Condition1        9
SaleType          9
Condition2        8
HouseStyle        8
RoofMatl          7
GarageType        7
Functional        7
BsmtFinType1      7
BsmtFinType2      7
Heating           6
RoofStyle         6
SaleCondition     6
Foundation        6
FireplaceQu       6
GarageCond        6
GarageQual        6
MSZoning          5
LotConfig         5
MiscFeature       5
Fence             5
BldgType          5
HeatingQC         5
ExterCond         5
Electrical        5
BsmtQual          5
BsmtCond          5
BsmtExposure      5
MasVnrType        4
LotShape          4
ExterQual         4
KitchenQual       4
PoolQC            4
GarageFinish      4
LandContour       4
Alley             3
LandSlope         3
PavedDrive        3
Utilities         2
Street            2
CentralAir        2
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Neighborhood has most number of unique categories. The categories are some sort of location names.</p>
<div class="section" id="google-api-geocoding">
<h3>1.5.1. Google API: Geocoding<a class="headerlink" href="#google-api-geocoding" title="Permalink to this headline">¶</a></h3>
<p>In this section, we will extract Latitude and Longitude coordinates, and zipcodes from Google’s Geocoding API.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">googlemaps</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="c1"># Import the googlemaps API key</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/keys.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    
<span class="n">gmaps</span> <span class="o">=</span> <span class="n">googlemaps</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">keys</span><span class="p">[</span><span class="s1">&#39;geocoding&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of neighborhoods</span>
<span class="n">housing</span><span class="o">.</span><span class="n">Neighborhood</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>array([&#39;CollgCr&#39;, &#39;Veenker&#39;, &#39;Crawfor&#39;, &#39;NoRidge&#39;, &#39;Mitchel&#39;, &#39;Somerst&#39;,
       &#39;NWAmes&#39;, &#39;OldTown&#39;, &#39;BrkSide&#39;, &#39;Sawyer&#39;, &#39;NridgHt&#39;, &#39;NAmes&#39;,
       &#39;SawyerW&#39;, &#39;IDOTRR&#39;, &#39;MeadowV&#39;, &#39;Edwards&#39;, &#39;Timber&#39;, &#39;Gilbert&#39;,
       &#39;StoneBr&#39;, &#39;ClearCr&#39;, &#39;NPkVill&#39;, &#39;Blmngtn&#39;, &#39;BrDale&#39;, &#39;SWISU&#39;,
       &#39;Blueste&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">neighborhoods</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;CollgCr&quot;</span><span class="p">:</span><span class="s2">&quot;College Creek&quot;</span><span class="p">,</span><span class="s2">&quot;Veenker&quot;</span><span class="p">:</span><span class="s2">&quot;Veenker&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Crawfor&quot;</span><span class="p">:</span><span class="s2">&quot;Crawford&quot;</span><span class="p">,</span><span class="s2">&quot;NoRidge&quot;</span><span class="p">:</span><span class="s2">&quot;Northridge&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Mitchel&quot;</span><span class="p">:</span><span class="s2">&quot;Mitchell&quot;</span><span class="p">,</span><span class="s2">&quot;Somerst&quot;</span><span class="p">:</span><span class="s2">&quot;Somerset&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;NWAmes&quot;</span><span class="p">:</span><span class="s2">&quot;Northwest Ames&quot;</span><span class="p">,</span><span class="s2">&quot;OldTown&quot;</span><span class="p">:</span><span class="s2">&quot;Old Town&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;BrkSide&quot;</span><span class="p">:</span><span class="s2">&quot;Brookside&quot;</span><span class="p">,</span><span class="s2">&quot;Sawyer&quot;</span><span class="p">:</span><span class="s2">&quot;Sawyer&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;NridgHt&quot;</span><span class="p">:</span><span class="s2">&quot;Northridge Heights&quot;</span><span class="p">,</span><span class="s2">&quot;NAmes&quot;</span><span class="p">:</span><span class="s2">&quot;North Ames&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;SawyerW&quot;</span><span class="p">:</span><span class="s2">&quot;Sawyer West&quot;</span><span class="p">,</span><span class="s2">&quot;IDOTRR&quot;</span><span class="p">:</span><span class="s2">&quot;Iowa DOT and Rail Road&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;MeadowV&quot;</span><span class="p">:</span><span class="s2">&quot;Meadow Village&quot;</span><span class="p">,</span><span class="s2">&quot;Edwards&quot;</span><span class="p">:</span><span class="s2">&quot;Edwards&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Timber&quot;</span><span class="p">:</span><span class="s2">&quot;Timberland&quot;</span><span class="p">,</span><span class="s2">&quot;Gilbert&quot;</span><span class="p">:</span><span class="s2">&quot;Gilbert&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;StoneBr&quot;</span><span class="p">:</span><span class="s2">&quot;Stone Brook&quot;</span><span class="p">,</span><span class="s2">&quot;ClearCr&quot;</span><span class="p">:</span><span class="s2">&quot;Clear Creek&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;NPkVill&quot;</span><span class="p">:</span><span class="s2">&quot;Northpark Villa&quot;</span><span class="p">,</span><span class="s2">&quot;Blmngtn&quot;</span><span class="p">:</span><span class="s2">&quot;Bloomington Heights&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;BrDale&quot;</span><span class="p">:</span><span class="s2">&quot;Briardale&quot;</span><span class="p">,</span><span class="s2">&quot;SWISU&quot;</span><span class="p">:</span><span class="s2">&quot;South &amp; West of Iowa State University&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;Blueste&quot;</span><span class="p">:</span><span class="s2">&quot;Bluestem&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s create a separate dataframe with unique Neighborhood categories</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">Neighborhood</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Neighborhood&#39;</span><span class="p">])</span>
<span class="n">geo_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Neighborhood</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CollgCr</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Veenker</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Crawfor</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NoRidge</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mitchel</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="k">def</span> <span class="nf">getGeoInfo</span><span class="p">(</span><span class="n">Neighborhood</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">     Enter the Neighborhood and the kind of output you want (lat,lng, or zipcode)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">getZipCode</span><span class="p">(</span><span class="n">formatted_address</span><span class="p">):</span>
        <span class="n">substr</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;IA \d</span><span class="si">{5}</span><span class="s1">, USA&#39;</span><span class="p">,</span><span class="n">formatted_address</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">substr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;Missing&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\d</span><span class="si">{5}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">substr</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">geocode_result</span> <span class="o">=</span> <span class="n">gmaps</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="n">neighborhoods</span><span class="p">[</span><span class="n">Neighborhood</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;, Ames, IA&#39;</span><span class="p">)</span>
    
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">geocode_result</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="s1">&#39;IA&#39;</span> <span class="ow">in</span> <span class="n">geocode_result</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;formatted_address&#39;</span><span class="p">]:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">break</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="n">lat</span> <span class="o">=</span> <span class="n">geocode_result</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
    <span class="n">lng</span> <span class="o">=</span> <span class="n">geocode_result</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;location&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">]</span>
    <span class="n">zipcode</span> <span class="o">=</span> <span class="n">getZipCode</span><span class="p">(</span><span class="n">geocode_result</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="s1">&#39;formatted_address&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lat</span>
    <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;lng&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lng</span>
    <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;zipcode&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">zipcode</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;invalid output!&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;Lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;Neighborhood&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getGeoInfo</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
<span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;Lng&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;Neighborhood&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getGeoInfo</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;lng&#39;</span><span class="p">)</span>
<span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;zipcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;Neighborhood&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getGeoInfo</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;zipcode&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Neighborhood</th>
      <th>Lat</th>
      <th>Lng</th>
      <th>zipcode</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CollgCr</td>
      <td>42.022197</td>
      <td>-93.651510</td>
      <td>Missing</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Veenker</td>
      <td>42.041304</td>
      <td>-93.650302</td>
      <td>50011</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Crawfor</td>
      <td>42.018614</td>
      <td>-93.648898</td>
      <td>50014</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NoRidge</td>
      <td>42.047831</td>
      <td>-93.646745</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mitchel</td>
      <td>41.990308</td>
      <td>-93.601053</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Somerst</td>
      <td>42.052628</td>
      <td>-93.644582</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NWAmes</td>
      <td>42.038277</td>
      <td>-93.625770</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>7</th>
      <td>OldTown</td>
      <td>42.029046</td>
      <td>-93.614340</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>8</th>
      <td>BrkSide</td>
      <td>42.028653</td>
      <td>-93.630386</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Sawyer</td>
      <td>42.033903</td>
      <td>-93.677066</td>
      <td>50014</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NridgHt</td>
      <td>42.059773</td>
      <td>-93.649471</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>11</th>
      <td>NAmes</td>
      <td>42.049358</td>
      <td>-93.622442</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SawyerW</td>
      <td>42.024906</td>
      <td>-93.659599</td>
      <td>50014</td>
    </tr>
    <tr>
      <th>13</th>
      <td>IDOTRR</td>
      <td>42.021997</td>
      <td>-93.622018</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>14</th>
      <td>MeadowV</td>
      <td>41.991844</td>
      <td>-93.604238</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Edwards</td>
      <td>42.015510</td>
      <td>-93.685391</td>
      <td>50014</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Timber</td>
      <td>41.999973</td>
      <td>-93.649693</td>
      <td>50014</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Gilbert</td>
      <td>42.106929</td>
      <td>-93.649663</td>
      <td>50105</td>
    </tr>
    <tr>
      <th>18</th>
      <td>StoneBr</td>
      <td>42.059727</td>
      <td>-93.637642</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ClearCr</td>
      <td>42.036097</td>
      <td>-93.648830</td>
      <td>50011</td>
    </tr>
    <tr>
      <th>20</th>
      <td>NPkVill</td>
      <td>42.030781</td>
      <td>-93.631913</td>
      <td>Missing</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Blmngtn</td>
      <td>42.056376</td>
      <td>-93.644471</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>22</th>
      <td>BrDale</td>
      <td>42.052795</td>
      <td>-93.628821</td>
      <td>50010</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SWISU</td>
      <td>42.026657</td>
      <td>-93.646452</td>
      <td>50011</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Blueste</td>
      <td>42.023090</td>
      <td>-93.663783</td>
      <td>50014</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In geo_df, there are two Neighborhoods (CollgCr, NPkVill) for which Google’s gecoding API was not able to provide the zipcode.</p>
<p>Lets look at Lat vs. Lng scatter plot to see which neighborhoods are close to those with missing zipcode.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;Lng&#39;</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">geo_df</span><span class="p">,</span>
                <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;zipcode&#39;</span><span class="p">,</span>
                <span class="n">palette</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="s1">&#39;blue&#39;</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.35</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00-data-wrangling_81_0.png" src="_images/00-data-wrangling_81_0.png" />
</div>
</div>
<p>It will be reasonable to impute missing zipcodes with the closest neighbors, but there is another library that can provide zipcode info based on geo coordinates.</p>
<p>It is the <strong>uszipcode</strong> library https://pypi.org/project/uszipcode/</p>
<p>This library can be used to extract demographic information of different locations in US.</p>
</div>
<div class="section" id="uszipcode">
<h3>1.5.2. uszipcode<a class="headerlink" href="#uszipcode" title="Permalink to this headline">¶</a></h3>
<p>In this section, we will impute the missing zipcode, as well as augment our dataset with more features like popution density, total population, median household income, total number of housing units, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">uszipcode</span> <span class="k">import</span> <span class="n">SearchEngine</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getMoreFeat</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Can take zipcode or [lat,lng] as inputs (a) and return requested information about location, </span>
<span class="sd">    The information requested should be specifed as the second argument (b).</span>

<span class="sd">    Acceptable requests are:&#39;lat&#39;, &#39;lng&#39;, </span>
<span class="sd">                            &#39;population&#39;, &#39;zipcode&#39;, </span>
<span class="sd">                            &#39;population_density&#39;,&#39;housing_units&#39;,</span>
<span class="sd">                            &#39;occupied_housing_units&#39;, &#39;median_home_value&#39;</span>
<span class="sd">                            &#39;median_household_income&#39;</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">getZipCode</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
        <span class="n">geo_info</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">by_coordinates</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">geo_info</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">geo_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">post_office_city</span> <span class="o">==</span> <span class="s1">&#39;Ames, IA&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">geo_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">major_city</span> <span class="o">==</span> <span class="s1">&#39;Ames&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">geo_info</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">common_city_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Ames&#39;</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coordinates don&#39;t belong to Ames, IA. NaN returned&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">geo_info</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="n">b</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">getRequest</span><span class="p">(</span><span class="n">zipcode</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="n">geo_info</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">by_zipcode</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">geo_info</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()[</span><span class="n">b</span><span class="p">]</span>
        
        
    <span class="n">search</span> <span class="o">=</span> <span class="n">SearchEngine</span><span class="p">(</span><span class="n">simple_zipcode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;zipcode&#39;</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">getZipCode</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lng&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;zipcode&#39;</span><span class="p">,</span> 
                  <span class="s1">&#39;population_density&#39;</span><span class="p">,</span><span class="s1">&#39;housing_units&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;occupied_housing_units&#39;</span><span class="p">,</span> <span class="s1">&#39;median_home_value&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;median_household_income&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">getRequest</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
        
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">geo_df</span><span class="o">.</span><span class="n">zipcode</span><span class="o">==</span><span class="s1">&#39;Missing&#39;</span><span class="p">,</span><span class="s1">&#39;zipcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geo_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">geo_df</span><span class="o">.</span><span class="n">zipcode</span><span class="o">==</span><span class="s1">&#39;Missing&#39;</span><span class="p">,[</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lng&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getMoreFeat</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;zipcode&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;median_household_income&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;zipcode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getMoreFeat</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;median_household_income&#39;</span><span class="p">)</span>
<span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;median_home_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;zipcode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">getMoreFeat</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;median_home_value&#39;</span><span class="p">)</span>
<span class="n">geo_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Neighborhood</th>
      <th>Lat</th>
      <th>Lng</th>
      <th>zipcode</th>
      <th>median_household_income</th>
      <th>median_home_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CollgCr</td>
      <td>42.022197</td>
      <td>-93.651510</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Veenker</td>
      <td>42.041304</td>
      <td>-93.650302</td>
      <td>50011</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Crawfor</td>
      <td>42.018614</td>
      <td>-93.648898</td>
      <td>50014</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NoRidge</td>
      <td>42.047831</td>
      <td>-93.646745</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mitchel</td>
      <td>41.990308</td>
      <td>-93.601053</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Somerst</td>
      <td>42.052628</td>
      <td>-93.644582</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NWAmes</td>
      <td>42.038277</td>
      <td>-93.625770</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>OldTown</td>
      <td>42.029046</td>
      <td>-93.614340</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>BrkSide</td>
      <td>42.028653</td>
      <td>-93.630386</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Sawyer</td>
      <td>42.033903</td>
      <td>-93.677066</td>
      <td>50014</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NridgHt</td>
      <td>42.059773</td>
      <td>-93.649471</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>NAmes</td>
      <td>42.049358</td>
      <td>-93.622442</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SawyerW</td>
      <td>42.024906</td>
      <td>-93.659599</td>
      <td>50014</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>IDOTRR</td>
      <td>42.021997</td>
      <td>-93.622018</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>MeadowV</td>
      <td>41.991844</td>
      <td>-93.604238</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Edwards</td>
      <td>42.015510</td>
      <td>-93.685391</td>
      <td>50014</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Timber</td>
      <td>41.999973</td>
      <td>-93.649693</td>
      <td>50014</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Gilbert</td>
      <td>42.106929</td>
      <td>-93.649663</td>
      <td>50105</td>
      <td>80703.0</td>
      <td>165400.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>StoneBr</td>
      <td>42.059727</td>
      <td>-93.637642</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ClearCr</td>
      <td>42.036097</td>
      <td>-93.648830</td>
      <td>50011</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>20</th>
      <td>NPkVill</td>
      <td>42.030781</td>
      <td>-93.631913</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Blmngtn</td>
      <td>42.056376</td>
      <td>-93.644471</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>BrDale</td>
      <td>42.052795</td>
      <td>-93.628821</td>
      <td>50010</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SWISU</td>
      <td>42.026657</td>
      <td>-93.646452</td>
      <td>50011</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Blueste</td>
      <td>42.023090</td>
      <td>-93.663783</td>
      <td>50014</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>There are missing values in median_household_income and median_home_value column.</p>
<p>Lets impute missing values using K-nearest neighbor imputer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">missingpy</span> <span class="k">import</span> <span class="n">KNNImputer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span><span class="p">[</span><span class="s1">&#39;zipcode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">geo_df</span><span class="o">.</span><span class="n">zipcode</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Neighborhood&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">geo_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">geo_df</span><span class="p">),</span><span class="n">columns</span><span class="o">=</span><span class="n">geo_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">geo_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">geo_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Neighborhood</th>
      <th>Lat</th>
      <th>Lng</th>
      <th>zipcode</th>
      <th>median_household_income</th>
      <th>median_home_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CollgCr</td>
      <td>42.022197</td>
      <td>-93.651510</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Veenker</td>
      <td>42.041304</td>
      <td>-93.650302</td>
      <td>50011.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Crawfor</td>
      <td>42.018614</td>
      <td>-93.648898</td>
      <td>50014.0</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NoRidge</td>
      <td>42.047831</td>
      <td>-93.646745</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mitchel</td>
      <td>41.990308</td>
      <td>-93.601053</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Somerst</td>
      <td>42.052628</td>
      <td>-93.644582</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NWAmes</td>
      <td>42.038277</td>
      <td>-93.625770</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>OldTown</td>
      <td>42.029046</td>
      <td>-93.614340</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>BrkSide</td>
      <td>42.028653</td>
      <td>-93.630386</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Sawyer</td>
      <td>42.033903</td>
      <td>-93.677066</td>
      <td>50014.0</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NridgHt</td>
      <td>42.059773</td>
      <td>-93.649471</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>NAmes</td>
      <td>42.049358</td>
      <td>-93.622442</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SawyerW</td>
      <td>42.024906</td>
      <td>-93.659599</td>
      <td>50014.0</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>IDOTRR</td>
      <td>42.021997</td>
      <td>-93.622018</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>MeadowV</td>
      <td>41.991844</td>
      <td>-93.604238</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Edwards</td>
      <td>42.015510</td>
      <td>-93.685391</td>
      <td>50014.0</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Timber</td>
      <td>41.999973</td>
      <td>-93.649693</td>
      <td>50014.0</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Gilbert</td>
      <td>42.106929</td>
      <td>-93.649663</td>
      <td>50105.0</td>
      <td>80703.0</td>
      <td>165400.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>StoneBr</td>
      <td>42.059727</td>
      <td>-93.637642</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ClearCr</td>
      <td>42.036097</td>
      <td>-93.648830</td>
      <td>50011.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>NPkVill</td>
      <td>42.030781</td>
      <td>-93.631913</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Blmngtn</td>
      <td>42.056376</td>
      <td>-93.644471</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>BrDale</td>
      <td>42.052795</td>
      <td>-93.628821</td>
      <td>50010.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SWISU</td>
      <td>42.026657</td>
      <td>-93.646452</td>
      <td>50011.0</td>
      <td>48189.0</td>
      <td>165300.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Blueste</td>
      <td>42.023090</td>
      <td>-93.663783</td>
      <td>50014.0</td>
      <td>37661.0</td>
      <td>212500.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geo_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 25 entries, 0 to 24
Data columns (total 6 columns):
Neighborhood               25 non-null object
Lat                        25 non-null float64
Lng                        25 non-null float64
zipcode                    25 non-null float64
median_household_income    25 non-null float64
median_home_value          25 non-null float64
dtypes: float64(5), object(1)
memory usage: 1.2+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">##Adding new features to FEATURES dictionary</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">geo_df</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s1">&#39;Neighborhood&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="o">+</span><span class="s1">&#39; already in FETAURES[&quot;cat&quot;]&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">geo_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
        <span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;aug_cat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;aug_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Neighborhood already in FETAURES[&quot;cat&quot;]
</pre></div>
</div>
</div>
</div>
<p>Now that geo_df is ready, which includes geographical and demographical information, lets merge it with the main dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">augment</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">geo_df</span><span class="p">):</span>
    <span class="n">X</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">geo_df</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">X</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span>

<span class="n">augmenter</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">augment</span><span class="p">,</span><span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">kw_args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">geo_df</span><span class="o">=</span><span class="n">geo_df</span><span class="p">))</span>
<span class="n">transformers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;augmenter&#39;</span><span class="p">,</span><span class="n">augmenter</span><span class="p">))</span>

<span class="n">housing</span> <span class="o">=</span> <span class="n">augmenter</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">housing</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>(1454, 87)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/test.csv&#39;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Id&#39;</span><span class="p">)</span>
<span class="n">my_pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">transformers</span><span class="p">)</span>
<span class="n">my_pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">housing_raw</span><span class="p">)</span>
<span class="n">housing_temp</span> <span class="o">=</span> <span class="n">my_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">housing_raw</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Manually and pipeline created datasets are equal:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">housing</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">housing_temp</span><span class="p">))</span>

<span class="n">test_temp</span> <span class="o">=</span> <span class="n">my_pipeline</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Manually and pipeline created datasets are equal:
True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add newly added numerical features to FEATURES dictionary</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">housing</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;aug_num&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">feature</span><span class="o">+</span><span class="s1">&#39; is missing in housing_temp&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>SalePrice is missing in housing_temp
log1p(SalePrice) is missing in housing_temp
</pre></div>
</div>
</div>
</div>
<p>Correlations of the newly added geographic and demograpic features with the target variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">housing</span><span class="p">[[</span><span class="s1">&#39;log1p(SalePrice)&#39;</span><span class="p">,</span><span class="s1">&#39;SalePrice&#39;</span><span class="p">,</span><span class="s1">&#39;Lat&#39;</span><span class="p">,</span><span class="s1">&#39;Lng&#39;</span><span class="p">,</span><span class="s1">&#39;zipcode&#39;</span><span class="p">,</span><span class="s1">&#39;median_household_income&#39;</span><span class="p">,</span><span class="s1">&#39;median_home_value&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">corr</span><span class="p">(),</span>
           <span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">annot_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Matrix&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1, &#39;Correlation Matrix&#39;)
</pre></div>
</div>
<img alt="_images/00-data-wrangling_101_1.png" src="_images/00-data-wrangling_101_1.png" />
</div>
</div>
<p>Correlations are high, but lets keep these features for now. We will come back to this later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dimensions of the dataset&#39;</span><span class="p">,</span><span class="n">housing</span><span class="p">[</span><span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;num&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">FEATURES</span><span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>Dimensions of the dataset (1454, 80)
</pre></div>
</div>
</div>
</div>
<p><strong>At this point, data is free of outliers and missing values.</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/wrangled_data.pkl&#39;</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="n">housing</span><span class="p">,</span><span class="n">FEATURES</span><span class="p">,</span><span class="n">transformers</span><span class="p">),</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">House Price Prediction</a>
    <a class='right-next' id="next-link" href="01-data-storytelling.html" title="next page">2. Data Storytelling</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Chirag Limbachia<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>